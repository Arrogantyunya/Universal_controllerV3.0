

#  通用控制器（C002）协议

设备协议原则：

1、按键申请主控设备号

3、外挂设备通过扫码识别类型绑定到数据库(执行器或传感器)

4、数字输出：2路，参数：路数1byte,状态1byte,设备类型id:

5、模拟输出：2路，参数：路数1byte,值3byteBCD码,单位V设备类型id:

6、数字输入：2路，参数：路数1byte,状态1byte,设备类型id:  

7、模拟输入：2路，参数：路数1byte,值3byteBCD码,单位V,(4-20ma,0-10V)

8、485设备：最多32路，参数：透传数据nbyte,设备类型id:  单独罗列

## 通用控制器各id字段解释

- **控制器设备类型（DeviceTypeId）：**LoRa通用控制器（C002）

  > `控制器设备类型指`：每种大类型控制器的类型ID,比如卷膜机控制器、通用控制器等，该控制器需要按键上报LoRa参数，并配置SN等。

- **输入输出接口类型(InterfaceTypeId)：**数字输出（C003）【数字输出1,2路为普通数字输出；3,4路为继电器输出】、模拟输出（C004）、485接口（C005）、数字输入（0004）、模拟输入（0005）

  > `输入输出接口类型指`：控制器下外挂的接口，如：数字输入输出、模拟输入输出、485接口等

- **子设备类型（SlaverTypeId）:**每个输出接口挂载的设备的类型，在每种接口通讯协议后附带罗列

  > `子设备类型指`：某种接口下外挂的设备类型，如：数字输出（C003）下外挂的设备是电磁阀，其SlaverTypeId为0001

- 初始化原则：

  > 一个设备第一次发送申号指令时，区域ID以及SN全为0，然后就等待主机发送其他的设置指令。

## 一、通用控制器公共指令

### 1.1、查询LORA主设备的参数（当前区域以及SN）frameId:A011）

`兼容预留设置LoRa设备时间及间隔协议`

`可查询主设备及子设备参数，role==0x00查询（或设置）主设备参数，role==0x55查询（或设置）所有设备参数，role==子设备路数，查询（或设置）相应路数参数`

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |            8             |    9     |         10-11          |      12-18      |      19-26       |  27  |       28-32       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :----------------------: | :------: | :--------------------: | :-------------: | :--------------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID | 要求LoRa设备重新请求分号 | 查询角色 | LoRa设备的采集时间间隔 | 新设置的RTC时间 |     预留字段     | CRC  |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId |          intent          | channel  |        Interval        |     Newtime     |     Allocate     | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |            1             |    1     |           2            |        7        |        8         |  1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A011   |    17    |       C002       |     00      |   01   |            55            |    00    |          003C          | 20190924132414  | 0000000000000000 |  00  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明                     | 长度（byte） | 备注                                                         |
| --------------- | :----------------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头                 |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址                 |      4       | 00000071(广播，所有设备上报自己的ID和SN)                     |
| deviceOthers    | 控制字等                 |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头                     |      1       | FE                                                           |
| frameId         | 帧ID                     |      2       | 查看帧id对照表A011                                           |
| dataLen         | 数据长度                 |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID         |      2       | 查看设备类型对照表（C002）（5555：所有类型）                 |
| isBroadcast     | 是否广播                 |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id                   |      1       | 0x55表示所有区域                                             |
| intent          | 要求LoRa设备重新请求分号 |      1       | 0x00：不请求只设置参数，0x55：重新请求                       |
| channel         | 查询角色                 |      1       | 0x00：表示主控，0x55:表示所有设备参数，其他表示相应路数的子设备 |
| Interval        | LoRa设备的采集时间间隔   |      2       | 十六进制整数，单位为秒                                       |
| NewTime         | 新设置的RTC时间          |      7       | BCD码值，如`20180824141702`代表`2018年8月24日14点17分零2秒`  |
| Allocate        | 预留字段                 |      8       | 预留做他用                                                   |
| CRC8            | CRC8校验码               |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾                     |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

查询通用控制器（C002）【XX代表无所谓什么数值】

```c
61 0C0E2418 000000 FE A011 0D C002 00 XX XXXXXXXXXXXXXXXXXX D6 0D0A0D0A0D0A
61 0C4E5104 000000 FE A011 0D C002 00 01 000000000000000000 D6 0D0A0D0A0D0A
```

### 1.2基地服务器设置LoRa设备工作组编号(A012)

`channel==0x00表示设置主设备参数，channel==0x55表示设置所有子设备参数，等于其他表示设置其下属的某路子设备参数`

协议格式如下`表1-1-1`

#### 协议帧格式

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |     4\|5     |      6      |   7    |     8-12     |   13    |  14  |       15-20       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :----------: | :---------: | :----: | :----------: | :-----: | :--: | :---------------: |
|              |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 |   设备类型   |  是否广播   |  区域  |   编号数组   |  路数   | CRC8 |       帧尾        |
|    数据域    | DeviceFrameHead |   Addr   | deviceOthers | FrameHead | FrameId | DataLen  | DeviceTypeId | IsBroadcast | ZoneId | GroupIdArray | channel | CRC8 |     FrameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |      2       |      1      |   1    |      5       |    1    |  1   |         2         |
|   示例数据   |       61        | 00000071 |   00 XXXX    |    FE     |  A012   |    10    |     C001     |     00      |   01   |  0000000000  |   00    |  00  | 0D 0A 0D 0A 0D 0A |

协议帧各字段域说明：

| 字段域          | 说明         | 长度（byte） | 备注                                                         |
| --------------- | :----------- | :----------: | :----------------------------------------------------------- |
| DeviceFrameHead | 硬件帧头     |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| Addr            | 设备地址     |      4       | 00000071(广播，所有设备上报自己的ID和SN)                     |
| deviceOthers    | 控制字等     |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| FrameHead       | 帧头         |      2       | FE                                                           |
| FrameId         | 帧ID         |      2       | A012                                                         |
| DataLen         | 数据长度     |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| DeviceTypeId    | 设备类型ID   |      2       | 查看设备类型对照表（5555：所有类型）                         |
| IsBroadcast     | 是否广播指令 |      1       | 0x55是，00否                                                 |
| ZoneId          | 所属区域Id   |      1       | 0x55表示所有区域                                             |
| GroupIdArray    | 组编号数组   |      5       | 最多5个组，组id(2byte)不为00时有效                           |
| CRC8            | CRC8校验码   |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| FrameEnd        | 帧尾         |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

设置ID为`0C3B6214`的设备组编号数组为0100000000

```shell
61 0C3B6214 000100 FE A012 0A C001 00 01 0100000000 00 57 0D0A0D0A0D0A
```

**基地服务器发送设置指令(添加到发送队列)**

```javascript
addCmdToSenderPool('REPLACE', loRaSenderPacket);
```

**发生错误回复系统状态**

```javascript
__redisPub_sysConfigAck('LORA_COMMON_CMD', "SET_GROUP_ID_ARRAY", 'failure', "设置LoRa设备工作组编号发生错误", errInfo);
```

### 1.3、基地服务器设置设备（主/子）SN及子设备总路数(A013)

### 协议帧格式

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |     4\|5     |      6       |     7      |       8       |      9       |       10-18        |     19     |       20-25       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :----------: | :----------: | :--------: | :-----------: | :----------: | :----------------: | :--------: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 |  设备类型ID  | 是否广播指令 | 所属区域ID |   设备路数    | 子设备总路数 |  设置的LORA设备SN  | CRC8校验码 |       帧尾        |
|    数据域    | DeviceFrameHead |   Addr   | DeviceOthers | FrameHead | FrameId | DataLen  | DeviceTypeId | IsBroadcast  |   ZoneId   | DeviceChannel | SlaverCount  |      DeviceSn      |    CRC8    |     FrameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |      2       |      1       |     1      |       1       |      1       |         9          |     1      |         2         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A013   |    0F    |     C001     |      55      |     01     |      00       |      00      | 000000000000000000 |     00     | 0D 0A 0D 0A 0D 0A |

协议帧各字段域说明：

| 字段域          | 说明             | 长度（byte） | 备注                                                         |
| --------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| DeviceFrameHead | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| Addr            | 设备地址         |      4       | 00000071(广播，所有设备上报自己的ID和SN)                     |
| DeviceOthers    | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| FrameHead       | 帧头             |      1       | FE                                                           |
| FrameId         | 帧ID             |      2       | A013                                                         |
| DataLen         | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| DeviceTypeId    | 设备类型ID       |      2       | 查看设备类型对照表                                           |
| IsBroadcast     | 是否广播指令     |      1       | 0x55是，00否                                                 |
| ZoneId          | 所属区域Id       |      1       | 0x55表示所有区域                                             |
| DeviceChannel   | 设备路数         |      1       | 主设备：0x00                                                 |
| SlaverCount     | 子设备总路数     |      1       | 子设备总数                                                   |
| DeviceSn        | 设置的LoRa设备SN |      9       |                                                              |
| CRC8            | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| FrameEnd        | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

```javascript
61 14432A0C 000100 FE A013 0E C002 01 00 02 C00120190304150001 15 0D0A0D0A0D0A
FE A013 0F C002 00 01 01 01 C002 20190926114601 E7 0D0A0D0A0D0A
```

### 1.4 查询LoRa设备当前工作状态（A014）

#### 协议帧格式，具体设备查看4

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |     4\|5     |      6       |   7    |    8    |    9     |     10     |       11-16       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :----------: | :----------: | :----: | :-----: | :------: | :--------: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 |  设备类型ID  | 是否广播指令 | 区域ID |  组ID   | 查询角色 | CRC8校验码 |       帧尾        |
|    数据域    | DeviceFrameHead |   Addr   | deviceOthers | FrameHead | FrameId | DataLen  | DeviceTypeId | IsBroadcast  | ZoneId | GroupId | channel  |    CRC8    |     FrameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |      2       |      1       |   1    |    1    |    1     |     1      |         2         |
|   示例数据   |       61        | 00000071 |   00 XXXX    |    FE     |  A014   |    06    |     5555     |      55      |   01   |   01    |    00    |     00     | 0D 0A 0D 0A 0D 0A |

协议帧各字段域说明：

| 字段域          | 说明         | 长度（byte） | 备注                                                         |
| --------------- | :----------- | :----------: | :----------------------------------------------------------- |
| DeviceFrameHead | 硬件帧头     |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| Addr            | 设备地址     |      4       | 00000071(广播，所有设备上报自己的ID和SN)                     |
| deviceOthers    | 控制字等     |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| FrameHead       | 帧头         |      2       | FE                                                           |
| FrameId         | 帧ID         |      2       | A011                                                         |
| DataLen         | 数据长度     |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| DeviceTypeId    | 设备类型ID   |      2       | 查看设备类型对照表（5555：所有类型）                         |
| IsBroadcast     | 是否广播指令 |      1       | 0x55是，00否                                                 |
| ZoneId          | 所属区域Id   |      1       | 0x55表示所有区域                                             |
| GroupId         | 组id         |      1       |                                                              |
| channel         | 查询角色     |      1       | 0x00：表示主控，0x55表示所有，其他表示相应路数的子设备       |
| CRC8            | CRC8校验码   |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| FrameEnd        | 帧尾         |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

```javascript
61 14432A0C 000100 FE A014 04 C001 01 01 00 E1 0D0A0D0A0D0A
```

### 1.5强制停止工作指令（A015）

#### 协议帧格式

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3    |     4\|5     |      6      |   7    |    8    |    9    |  10  |       11-16       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :-----: | :----------: | :---------: | :----: | :-----: | :-----: | :--: | :---------------: |
|    数据域    | DeviceFrameHead |   Addr   | deviceOthers | FrameHead | FrameId | DataLen | DeviceTypeId | IsBroadcast | ZoneId | GroupId | channel | CRC8 |     FrameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1    |      2       |      1      |   1    |    1    |    1    |  1   |         2         |
|   示例数据   |       61        | 00000071 |   00 XXXX    |    FE     |  A015   |   06    |     5555     |     55      |   01   |   01    |   00    |  00  | 0D 0A 0D 0A 0D 0A |

协议帧各字段域说明：

| 字段域          | 说明         | 长度（byte） | 备注                                                         |
| --------------- | :----------- | :----------: | :----------------------------------------------------------- |
| DeviceFrameHead | 硬件帧头     |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| Addr            | 设备地址     |      4       | 00000071(广播，所有设备上报自己的ID和SN)                     |
| deviceOthers    | 控制字等     |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| FrameHead       | 帧头         |      2       | FE                                                           |
| FrameId         | 帧ID         |      2       | A015                                                         |
| DataLen         | 数据长度     |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| DeviceTypeId    | 设备类型ID   |      2       | 查看设备类型对照表（5555：所有类型）                         |
| IsBroadcast     | 是否广播指令 |      1       | 0x55是，00否                                                 |
| ZoneId          | 所属区域Id   |      1       | 0x55表示所有区域                                             |
| GroupId         | 组Id         |      1       | 0x55表示所有组                                               |
| Addr            | 设备地址     |      4       | 设备地址（全部为55555555）                                   |
| channel         | 查询角色     |      1       | 0x00：表示主控，0x55表示所有，其他表示相应路数的子设备       |
| CRC8            | CRC8校验码   |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| FrameEnd        | 帧尾         |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

要求ID为`14052A0C`，的LoRa主设备重新上报设置参数：

```javascript
61 14432A0C 000100 FE A015 04 C001 01 00 E1 0D0A0D0A0D0A
```

### 1.6按键上报当前参数（frameId:E011)

#### 返回协议帧格式

|   字节索引   |     0     |  1\|2   |    3    |     4\|5     |      6      |   7    |     8-12     |       13-21        |   22    |  23-24   |     25-31      |      32-39       |  40  |       41-46       |
| :----------: | :-------: | :-----: | :-----: | :----------: | :---------: | :----: | :----------: | :----------------: | :-----: | :------: | :------------: | :--------------: | :--: | :---------------: |
|    数据域    | FrameHead | FrameId | DataLen | DeviceTypeId | IsBroadcast | ZoneId | GroupIdArray |      DeviceSn      | channel | Interval |    NewTime     |     Allocate     | CRC8 |     FrameEnd      |
| 长度（byte） |     1     |    2    |    1    |      2       |      1      |   1    |      5       |         9          |    1    |    2     |       7        |        8         |  1   |         2         |
|   示例数据   |    FE     |  E011   |   24    |     C002     |     00      |   01   |  0100000000  | XXXXXXXXXXXXXXXXXX |   00    |  00 3C   | 20180824141702 | 0000000000000000 |  00  | 0D 0A 0D 0A 0D 0A |

协议帧各字段域说明：

| 字段域       | 说明                   | 长度（byte） | 备注                                                         |
| ------------ | :--------------------- | :----------: | :----------------------------------------------------------- |
| FrameHead    | 帧头                   |      2       | FE                                                           |
| FrameId      | 帧ID                   |      2       | E011                                                         |
| DataLen      | 数据长度               |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| DeviceTypeId | 设备类型ID             |      2       | 查看设备类型对照表                                           |
| IsBroadcast  | 是否广播指令           |      1       | 0x55是，00否                                                 |
| ZoneId       | 所属区域Id             |      1       | 0x55表示所有区域                                             |
| channel      | 子设备路数             |      1       | 0x00表示主设备（无子设备情况），其他表示相应路数             |
| GroupIdArray | 组编号数组             |      5       | 最多5个组，组id(2byte)不为00时有效                           |
| Interval     | LoRa设备的采集时间间隔 |      2       | 十六进制整数，单位为秒                                       |
| NewTime      | 新设置的RTC时间        |      7       | BCD码值，如`20180824141702`代表`2018年8月24日14点17分零2秒`  |
| Allocate     | 预留字段               |      8       | 预留做他用                                                   |
| CRC8         | CRC8校验码             |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| FrameEnd     | 帧尾                   |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

ID为`14052A0C`的LoRa设备重新上报设置参数：

```javascript
41 0C256514 000500 FE E011 24 C002 55 01 0100000000 C00120190304150001 00 0000 FFFFFFFFFFFFFF 0000000000000000 D6 0D0A0D0A0D0A
```

1.7 LoRa设备请求设置工作组编号（E012）

#### 协议帧格式

|   字节索引   |     0     |  1\|2   |    3    |     4\|5     |      6      |   6    |    7    |  8   |       9-14        |
| :----------: | :-------: | :-----: | :-----: | :----------: | :---------: | :----: | :-----: | :--: | :---------------: |
|    数据域    | FrameHead | FrameId | DataLen | DeviceTypeId | IsBroadcast | ZoneId | channel | CRC8 |     FrameEnd      |
| 长度（byte） |     1     |    2    |    1    |      2       |      1      |   1    |    1    |  1   |         2         |
|   示例数据   |    FE     |  E012   |   04    |     C001     |     55      |   01   |   00    |  00  | 0D 0A 0D 0A 0D 0A |

协议帧各字段域说明：

| 字段域       | 说明         | 长度（byte） | 备注                                                         |
| ------------ | :----------- | :----------: | :----------------------------------------------------------- |
| FrameHead    | 帧头         |      2       | FE                                                           |
| FrameId      | 帧ID         |      2       | E012                                                         |
| DataLen      | 数据长度     |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| DeviceTypeId | 设备类型ID   |      2       | 查看设备类型对照表                                           |
| IsBroadcast  | 是否广播指令 |      1       | 0x55是，00否                                                 |
| ZoneId       | 所属区域Id   |      1       | 0x55表示所有区域                                             |
| channel      | 设备路数     |      1       | 0x00表示主设备，其他表示相应路数                             |
| CRC8         | CRC8校验码   |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| FrameEnd     | 帧尾         |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

```javascript
41 0C2A4314 00BB00 FE E012 04 C001 01 00 E1 0D0A0D0A0D0A
```



### 1.8LoRa设备请求设置SN设备类型及子设备路数(E013)

#### 协议帧格式

|   字节索引   |     0     |  1\|2   |    3     |     4\|5     |      6       |   7    |       8       |     9      |                   |
| :----------: | :-------: | :-----: | :------: | :----------: | :----------: | :----: | :-----------: | :--------: | :---------------: |
|     说明     |   帧头    |  帧ID   | 数据长度 |   设备类型   | 是否广播指令 |  区域  |   设备路数    | CRC8校验码 |       帧尾        |
|    数据域    | FrameHead | FrameId | DataLen  | DeviceTypeId | IsBroadcast  | ZoneId | DeviceChannel |    CRC8    |     FrameEnd      |
| 长度（byte） |     1     |    2    |    1     |      2       |      1       |   1    |       1       |     1      |         2         |
|   示例数据   |    FE     |  E013   |    05    |     C001     |      55      |   01   |      01       |     00     | 0D 0A 0D 0A 0D 0A |

协议帧各字段域说明：

| 字段域        | 说明         | 长度（byte） | 备注                                                         |
| ------------- | :----------- | :----------: | :----------------------------------------------------------- |
| FrameHead     | 帧头         |      2       | FE                                                           |
| FrameId       | 帧ID         |      2       | E013                                                         |
| DataLen       | 数据长度     |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| DeviceTypeId  | 设备类型ID   |      2       | 查看设备类型对照表                                           |
| IsBroadcast   | 是否广播指令 |      1       | 0x55是，00否                                                 |
| ZoneId        | 所属区域Id   |      1       | 0x55表示所有区域                                             |
| DeviceChannel | 设备路数     |      1       | 主设备：0x00                                                 |
| CRC8          | CRC8校验码   |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| FrameEnd      | 帧尾         |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

```javascript
41 0C2A4314 004A00 FE E013 04 C001 01 00 E1 0D0A0D0A0D0A
610C3B6214000100FEA0120AC0010001010000000000570D0A0D0A0D0A
```

### 1.9LoRa设备上报实时工作状态（E014）

#### 返回协议帧格式

|   字节索引   |     0     |  1\|2   |    3    |     4\|5     |      6      |   7    |    8    |   9    | 10-11 |  12  |  13  |              14-29               |  30  |       31-36       |
| :----------: | :-------: | :-----: | :-----: | :----------: | :---------: | :----: | :-----: | :----: | :---: | :--: | :--: | :------------------------------: | :--: | :---------------: |
|    数据域    | FrameHead | FrameId | DataLen | DeviceTypeId | IsBroadcast | ZoneId | channel | status |  Vol  | Rssi | Csq  |             Allocate             | CRC8 |     FrameEnd      |
| 长度（byte） |     1     |    2    |    1    |      2       |      1      |   1    |    1    |   1    |   2   |  1   |  1   |                16                |  1   |         2         |
|   示例数据   |    FE     |  E014   |   12    |     C001     |     55      |   01   |   00    |   00   | 2EE0  |  FF  |  FF  | 00000000000000000000000000000000 |  00  | 0D 0A 0D 0A 0D 0A |

协议帧各字段域说明：

| 字段域       | 说明             | 长度（byte） | 备注                                                         |
| ------------ | :--------------- | :----------: | :----------------------------------------------------------- |
| FrameHead    | 帧头             |      2       | FE                                                           |
| FrameId      | 帧ID             |      2       | E014                                                         |
| DataLen      | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| DeviceTypeId | 设备类型ID       |      2       | 查看设备类型对照表（5555：所有类型）                         |
| IsBroadcast  | 是否广播指令     |      1       | 0x55是，00否                                                 |
| ZoneId       | 所属区域Id       |      1       | 0x55表示所有区域                                             |
| Addr         | 设备地址         |      4       | 设备地址（全部为55555555）                                   |
| status       | 设备当前工作状态 |      1       | 对应回执状态表                                               |
| Vol          | 电压             |      2       |                                                              |
| Rssi         | 性噪比           |      1       |                                                              |
| Csq          | 信号强度         |      1       |                                                              |
| Allocate     | 预留字段         |      16      | 预留做他用                                                   |
| CRC8         | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| FrameEnd     | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

ID为`14052A0C`的LoRa设备上报实时工作状态：

```
41 0C2A4314 00BF00 FE E014 29 C001 01 00 01 2EE0 FFFF 00000000000000000000000000000000 69 0D0A0D0A0D0A
```



### 1.10 LoRa设备通用回执(E015)

#### 返回协议帧格式

|   字节索引   |     0     |  1\|2   |    3     |     4\|5     |      6       |   7    |    8    |   9    |      10-17       |     18     |       19-24       |
| :----------: | :-------: | :-----: | :------: | :----------: | :----------: | :----: | :-----: | :----: | :--------------: | :--------: | :---------------: |
|     说明     |   帧头    |  帧ID   | 数据长度 |   设备类型   | 是否广播指令 |  区域  |  路数   | 状态值 |     预留字段     | CRC8校验码 |       帧尾        |
|    数据域    | FrameHead | FrameId | DataLen  | DeviceTypeId | IsBroadcast  | ZoneId | channel | status |     Allocate     |    CRC8    |     FrameEnd      |
| 长度（byte） |     1     |    2    |    1     |      2       |      1       |   1    |    1    |   1    |        8         |     1      |         2         |
|   示例数据   |    FE     |  E015   |    0E    |     C001     |      55      |   01   |   00    |   00   | 0000000000000000 |     00     | 0D 0A 0D 0A 0D 0A |

协议帧各字段域说明：

| 字段域       | 说明             | 长度（byte） | 备注                                                         |
| ------------ | :--------------- | :----------: | :----------------------------------------------------------- |
| FrameHead    | 帧头             |      2       | FE                                                           |
| FrameId      | 帧ID             |      2       | E012                                                         |
| DataLen      | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| DeviceTypeId | 设备类型ID       |      2       | 查看设备类型对照表（5555：所有类型）                         |
| IsBroadcast  | 是否广播指令     |      1       | 0x55是，00否                                                 |
| ZoneId       | 所属区域Id       |      1       | 0x55表示所有区域                                             |
| Addr         | 设备地址         |      4       | 设备地址（全部为55555555）                                   |
| status       | 设备当前工作状态 |      1       | 对应回执状态表                                               |
| Allocate     | 预留字段         |      8       | 预留做他用                                                   |
| CRC8         | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| FrameEnd     | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

ID为`14052A0C`的LoRa设备通用回执（收到查询参数指令）：

```
410C2A4314006100  FE E015 0D C001 01 00 01 0000000000000000 16 0D0A0D0A0D0A
```

## 二、通用控制器私有指令

### 2.1、☆设置LORA主设备的RTC时间（frameId:A018）

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |     8-13     |  14  |       15-20       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :----------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID |   RTC时间    | CRC  |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId |     RTC      | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |      6       |  1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A018   |    0A    |       C002       |     00      |   01   | XXXXXXXXXXXX |  00  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明             | 长度（byte） | 备注                                                         |
| --------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址         |      4       |                                                              |
| deviceOthers    | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头             |      1       | FE                                                           |
| frameId         | 帧ID             |      2       | 查看帧id对照表A018                                           |
| dataLen         | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id           |      1       |                                                              |
| RTC             | RTC时钟          |      6       | 年月日时分秒（130906093A14代表19年9月6日9点59分20秒）        |
| CRC8            | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾             |      6       | 0D 0A 0D 0A 0D 0A                                            |

**应用示例：**

设置通用控制器（C002）的RTC时间为19年9月6日9点59分20秒

```c
61 0C0E2418 000000 FE A018 0A C002 00 01 130906093B14 D6 0D0A0D0A0D0A
```

### 2.2、☆设置LORA主设备定时执行的时间段（frameId:A019）

**执行方式对照表**：

| 执行方式 | Turn off automatic execution | Daily implement | only once          | Reserve | Reserve |
| -------- | ---------------------------- | --------------- | ------------------ | ------- | ------- |
| 状态值   | 00                           | 01              | 02                 | 03      | 04      |
| 状态说明 | 关闭自动执行                 | 每天执行        | 仅对该区间执行一次 | 预留    | 预留    |

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |          8          |        9-10        |    11    |          12          | 13/13-15  | 14-19/16-21  | 20-25/22-27  | 26/28 |    27-32/29-34    |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :-----------------: | :----------------: | :------: | :------------------: | :-------: | :----------: | :----------: | :---: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID |      执行方式       | 输入输出接口类型ID | 设备路数 |      时间段序号      | 设定参数  |   开始时间   |   结束时间   |  CRC  |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId | Mode implementation |  interfaceTypeId   | channel  | Time Sequence Number |   para    |  start time  |   end time   | CRC8  |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |          1          |         2          |    1     |          1           |    1/3    |      6       |      6       |   1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A019   |  16/18   |       C002       |     00      |   01   |         01          |        C003        |    01    |          xx          | 01/0125E1 | XXXXXXXXXXXX | XXXXXXXXXXXX |  00   | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域              | 说明             | 长度（byte） | 备注                                                         |
| ------------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead     | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr                | 设备地址         |      4       |                                                              |
| deviceOthers        | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead           | 帧头             |      1       | FE                                                           |
| frameId             | 帧ID             |      2       | 查看帧id对照表A019                                           |
| dataLen             | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId        | 控制器设备类型ID |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast         | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId              | 区域Id           |      1       |                                                              |
| Mode implementation | 执行方式         |      1       | 查看执行方式对照表                                           |
| interfaceTypeId     | 输入输出接口类型 |      2       | 查看输入输出接口类型对照表                                   |
| channel             | 设备路数         |      1       |                                                              |
| Time Sequence Numbe | 时间段序号       |      1       | 所设定时间段的序号                                           |
| para                | 设定参数         |     1/3      | 数字输出时为1字节，模拟输出时为3字节                         |
|                     |                  |              |                                                              |
|                     |                  |              |                                                              |
| CRC8                | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd            | 帧尾             |      6       | 0D 0A 0D 0A 0D 0A                                            |

| 执行方式 | Turn off automatic execution | Daily implement | only once          | Reserve | Reserve |
| -------- | ---------------------------- | --------------- | ------------------ | ------- | ------- |
| 状态值   | 00                           | 01              | 02                 | 03      | 04      |
| 状态说明 | 关闭自动执行                 | 每天执行        | 仅对该区间执行一次 | 预留    | 预留    |

**应用示例：**

设置通用控制器(C002)数字输出接口（C003）的3路）当前执行方式为每天执行（执行para为开启），开始时间段1为xxxxxxxxxxxx，结束时间段为xxxxxxxxxxxx。

```c
61 0C331C10 000000 FE A019 16 C002 00 01 01 C003 03 01 01 130907122009 13090713241A D6 0D0A0D0A0D0A
```

### 2.3、设置某类型接口挂载的某一路子设备类型及工作组（frameId:A020）

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |        8-9         |    10    |    11-12     |    13-17     |  18  |       19-24       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :----------------: | :------: | :----------: | :----------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID | 输入输出接口类型ID | 设备路数 | 子设备类型ID | 子设备工作组 | CRC  |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId |  interfaceTypeId   | channel  | slaverTypeId | groupIdArray | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |         2          |    1     |      2       |      5       |  1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A020   |    0E    |       C002       |     00      |   01   |        C003        |    01    |     0001     |  0100000000  |  00  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明               | 长度（byte） | 备注                                                         |
| --------------- | :----------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头           |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址           |      4       |                                                              |
| deviceOthers    | 控制字等           |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头               |      1       | FE                                                           |
| frameId         | 帧ID               |      2       | 查看帧id对照表A020                                           |
| dataLen         | 数据长度           |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID   |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     | 是否广播           |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id             |      1       |                                                              |
| InterfaceTypeId | 输入输出接口类型Id |      2       |                                                              |
| channel         | 设备路数           |      1       | 该接口设备的路数，从01开始编号                               |
| slaverTypeId    | 子设备类型id       |      2       | 查看各接口协议子设备类型对照表                               |
| groupIdArray    | 子设备工作组数组   |      5       | 设备最多可以在某类型下的5个组内，默认在全部组                |
| CRC8            | CRC8校验码         |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾               |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

设置通用控制器（C002）通用输出接口(C003)路数为1的挂载设备为电磁阀（0001），其所处工作组为1\3\5组（0103050000）

```c
61 0C0E2418 000000 FE A020 0E C002 00 01 C003 01 0001 0103050000 D6 0D0A0D0A0D0A
```

### 2.4、查询输入输出接口状态（frameId:A021）

- zoneId为55表示全部区域
- 设备收到广播查询指令是，上报状态要增加一个延时随机数

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |  8   |       9-14        |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |    控制字    |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID | CRC8 |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |  1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A021   |    04    |       C002       |     00      |   01   |  00  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明             | 长度（byte） | 备注                                                         |
| --------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址         |      4       |                                                              |
| deviceOthers    | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头             |      1       | FE                                                           |
| frameId         | 帧ID             |      2       | 查看帧id对照表A021                                           |
| dataLen         | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id           |      1       |                                                              |
| CRC8            | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

```c
61 0C0E2418 000000 FE A021 04 C002 00 01 D6 0D0A0D0A0D0A
```

### 2.5、设置某路（或某组）输出设备状态（frameId:A022）

> **MCU解包逻辑：**mcu收到数据后判断isBroadcast，为广播读取groupId，自行判断是哪路来执行控制。单播直接读取channel控制。

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |    8    |        9-10        |    11    |    12-13     | 14/14-16 | 15-17/17-19 | 18/20 |    19-24/21-26    |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :-----: | :----------------: | :------: | :----------: | :------: | :---------: | :---: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |    控制字    |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID |  组ID   | 输入输出接口类型ID | 设备路数 | 子设备类型ID | 设定参数 |  工作时间   |  CRC  |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId | groupId |  interfaceTypeId   | channel  | slaverTypeId |   para   |    time     | CRC8  |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |    1    |         2          |    1     |      2       |   1/3    |      3      |   1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A022   |  0E/10   |       C002       |     00      |   01   |   01    |        C003        |    01    |     0001     |  00/01   |   00000A    |  00   | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明               | 长度（byte） | 备注                                                         |
| --------------- | :----------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头           |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址           |      4       |                                                              |
| deviceOthers    | 控制字等           |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头               |      1       | FE                                                           |
| frameId         | 帧ID               |      2       | 查看帧id对照表A020                                           |
| dataLen         | 数据长度           |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID   |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     | 是否广播           |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id             |      1       |                                                              |
| groupId         | 组id               |      1       |                                                              |
| InterfaceTypeId | 输入输出接口类型Id |      2       |                                                              |
| channel         | 设备路数           |      1       | 该接口设备的路数，从01开始编号                               |
| slaverTypeId    | 子设备类型id       |      2       | 查看各接口协议子设备类型对照表                               |
| para            | 设定参数           |     1/3      | 数字量（00低电平，01高电平），模拟量3byte                    |
| time            | 工作时间           |      3       | 单位S                                                        |
| CRC8            | CRC8校验码         |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾               |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

广播设置通用控制器（C002）通用输出接口(C003)，电磁阀（0001）组1的设备电平状态为高,工作时间10s

```C
61 0C0E2418 000000 FE A022 0E C002 00 01 01 C003 01 0001 01 00000A D6 0D0A0D0A0D0A
```

```c
61 0C0E2418 000000 FE A022 10 C002 00 01 01 C004 01 0001 0110E2 00000A D6 0D0A0D0A0D0A
```

单播设置通用控制器（C002）通用输出接口(C003)，01路电磁阀（0001）设备电平状态为高,工作时间10s

```json
61 0C0E2418 000000 FE A022 0E C002 00 01 01 C003 01 0001 01 00000A D6 0D0A0D0A0D0A
```

### 2.6、设置数字输入关联输出状态(A023)

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |      N       | N+1  |      N+2-N+7      |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :----------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID | 设置参数部分 | CRC8 |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId |     para     | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |      N       |  1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A023   |    XX    |       C002       |     00      |   01   |      N       |  00  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明             | 长度（byte） | 备注                                                         |
| --------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址         |      4       |                                                              |
| deviceOthers    | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头             |      1       | FE                                                           |
| frameId         | 帧ID             |      2       | 查看帧id对照表A020                                           |
| dataLen         | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id           |      1       |                                                              |
| para            | 设置参数部分     |      N       | 具体数据结构                                                 |
| CRC8            | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

电平变化及时间间隔到时上报

- X 表示继电器（数字）输入
- Y 表示继电器（数字）输出
- U模拟量输入
- V模拟量输出
- B预留：bool类型，预留8个，对应0x01
- I预留：int类型，预留8个，对应0x02
- T定时器：单位S，预留8个，对应0x03
- C计数器：单位次，预留8个，对应0x04
- D延时：单位S，单位秒，预留8个，对应0x05
- 逻辑关系：大于、小于、等于、位与，位或，小于等于，大于等于，与，或，非，异或，加加，减减，>  <  ==  &  |    ≤  ≥  && ||  ～ ^  ++  --

自控策略数据解析规则：

条件与执行间用`#`分割

多条件间或多条执行参数用间`；`分割

条件及执行参数内部用`，`分割

条件满足及不满足执行参数间用`:`分割

​                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            举例：
​	当数字输入01为高，模拟输入01>大于10V时，数字输出01设为高保持10S时间到后设为低，模拟输出01设为1V保持10S时间到后设为0.5V

```c
X1,=,1;&&;U1,>,1000E2#Y1,1:0,00000A;V1,0100E1:0050E2,00000A 
X1,=,1;&&;U1,>,1000E2#Y1,=,1;D0,=, 00000A;Y1,=,0;V1,=,0100E1;D0,=,00000A;V1,=,0050E2
//58312c3d2c313b26263b55312c3e2c3130303045322359312c313a302c3030303030413b56312c3031303045313a3030353045322c303030303041
61 0C0E2418 000000 FE A023 3F C002 00 01 58312c3d2c313b26263b55312c3e2c3130303045322359312c313a302c3030303030413b56312c30313030
45313a3030353045322c303030303041 D6 0D0A0D0A0D0A
```

```c
X1,=,1#V1,0100E1:0050E2,00000A
58312c3d2c312356312c3031303045313a3030353045322c303030303041
61 0C0E2418 000000 FE A023 22 C002 00 01 58312c3d2c312356312c3031303045313a3030353045322c303030303041 D6 0D0A0D0A0D0A

```

开启电磁阀，15S后读取有无水压，有则上报开启成功状态，没有则关闭并上报开启异常状态

```c
X1,=,1;&&;D0,=,F#B0,=,1//61 0C0E2418 000000 FE A023 1B C002 00 01 58312c3d2c313b26263b44302c3d2c462342302c3d2c31 D6 0D0A0D0A0D0A
B0,=,1;&&;U1,≤,5#X1,0;B0,=,0//61 0C0E2418 000000 FE A023 21 C002 00 01 42302c3d2c313b26263b55312c22642c352358312c303b42302c3d2c30 D6 0D0A0D0A0D0A
```

当水位大于上限（X0）时开始打开污水泵，当水位小于等于下限（X1）关闭污水泵（Y1）

```c
X0,=,1;&&;X1,=,1#Y1,=,1//61 0C0E2418 000000 FE A023 1B C002 00 01 58302c3d2c313b26263b58312c3d2c312359312c3d2c31 D6 0D0A0D0A0D0A
X0,=,0;&&;X1,=,1#Y1,=,0//61 0C0E2418 000000 FE A023 1B C002 00 01 58302c3d2c303b26263b58312c3d2c312359312c3d2c30 D6 0D0A0D0A0D0A
```

### 2.7、设置预留字段（B\I\T\C\D）值（A024）

- B预留：bool类型，预留8个，对应0x01
- I预留：int类型，预留8个，对应0x02
- T定时器：单位S，预留8个，对应0x03
- C计数器：单位次，预留8个，对应0x04
- D延时：单位S，单位秒，预留8个，对应0x05

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |    8     |  9/9-16  |  17  |       18-23       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :------: | :------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID | 设置字段 | 设置参数 | CRC8 |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId |  field   |   para   | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |    1     |   1/8    |  1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A024   |  6/0x0D  |       C002       |     00      |   01   |    01    |   Nxx    |  00  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明             | 长度（byte） | 备注                                                         |
| --------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址         |      4       |                                                              |
| deviceOthers    | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头             |      1       | FE                                                           |
| frameId         | 帧ID             |      2       | 查看帧id对照表A024                                           |
| dataLen         | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id           |      1       |                                                              |
| field           | 设置字段         |      1       | 0x01~0x05                                                    |
| para            | 设定参数         |      n       |                                                              |
| CRC8            | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

设置I的预留字段为01，05，08，2A，37，56，59，8E【都是16进制】

```c
61 0C0E2418 000000 FE A024 0D C002 00 01 02 0105082A3756598E D6 0D0A0D0A0D0A

```

### 2.8、设置485设备参数（A025）

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |    8-     |          |                   |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :-------: | :------: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID | 485的指令 | CRC8校验 |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId |  485para  |   CRC8   |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |     N     |    1     |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A025   |   N-4    |       C002       |     00      |   01   |     N     |    00    | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明             | 长度（byte） | 备注                                                         |
| --------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址         |      4       |                                                              |
| deviceOthers    | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头             |      1       | FE                                                           |
| frameId         | 帧ID             |      2       | 查看帧id对照表A020                                           |
| dataLen         | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id           |      1       |                                                              |
| 485para         | 485指令          |      N       | 485指令                                                      |
| CRC8            | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

```c
61 0C0E2418 000000 FE A025 0C C002 00 01 01 06 2000 0001 43CA D6 0D0A0D0A0D0A
```

### 2.9、查询状态(参数)回执(frameId:E021)

> 说明：不管是批量查询还是单个查询都是分开单独上报状态
>
> **协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |      8-9       |     10-11      |     12-14     |     15-17     |     18-20     |     21-23     |  24  |       25-30       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :------------: | :------------: | :-----------: | :-----------: | :-----------: | :-----------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |    控制字    |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID | 数字输入IO状态 | 数字输出IO状态 | 模拟输入1状态 | 模拟输入2状态 | 模拟输出1状态 | 模拟输出2状态 | CRC8 |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId |  digitalInput  |   digitalOut   | analogInput1  | analogInput2  | analogOutput1 | analogOutput2 | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |       2        |       2        |       3       |       3       |       3       |       3       |  1   |         6         |
|   示例数据   |       41        | 14052A0C |   00 XXXX    |    FE     |  E021   |    14    |       C002       |     00      |   01   |      XXXX      |      XXXX      |    XXXXXX     |    XXXXXX     |     XXXXX     |    XXXXXX     |  D6  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明             | 长度（byte） | 备注                                                         |
| --------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址         |      4       |                                                              |
| deviceOthers    | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头             |      1       | FE                                                           |
| frameId         | 帧ID             |      2       | 查看帧id对照表E021                                           |
| dataLen         | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id           |      1       |                                                              |
| digitalInput    | 数字输入IO状态   |      2       | 相应的位表示，1高，0低，高位在前低位在后。例如channel 1口状态为高 XXXX XXXX XXXX XXX1 B |
| digitalOutput   | 数字输出IO状态   |      2       | 相应的位表示，1高，0低，高位在前低位在后。例如channel 1口状态为高 XXXX XXXX XXXX XXX1 B |
| analogInput1    | 模拟输入1状态    |      3       | bcd码，单位V                                                 |
| analogInput2    | 模拟输入2状态    |      3       | bcd码，单位V                                                 |
| analogOutput1   | 模拟输出1状态    |      3       | bcd码，单位V                                                 |
| analogOutput2   | 模拟输出2状态    |      3       | bcd码，单位V                                                 |
| CRC8            | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

通用控制器(C002)数字输出接口（C003）通道1（挂载设备为电磁阀(0001)）当前状态为开启状态

```json
FE E021 0B C002 00 01 C003 0001 01 0001 01 D6 0D0A0D0A0D0A
```

### 2.10、☆剩余时间回执(frameId:E022)

> **协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |             8-10             |             11-13              |            14-16             |             17-19              |            20-22             |             23-25              |            26-28             |             29-31              |            32-34            |             35-37             |            38-40            |             41-43             |  44  |       45-50       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :--------------------------: | :----------------------------: | :--------------------------: | :----------------------------: | :--------------------------: | :----------------------------: | :--------------------------: | :----------------------------: | :-------------------------: | :---------------------------: | :-------------------------: | :---------------------------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |    控制字    |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID |      数字输出1设定时间       |       数字输出1剩余时间        |      数字输出2设定时间       |       数字输出2剩余时间        |      数字输出3设定时间       |       数字输出3剩余时间        |      数字输出4设定时间       |       数字输出4剩余时间        |      模拟输出1设定时间      |       模拟输出1剩余时间       |      模拟输出2设定时间      |       模拟输出2剩余时间       | CRC8 |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId | DigitalOutput_1 Setting Time | DigitalOutput_1 Remaining Time | DigitalOutput_2 Setting Time | DigitalOutput_2 Remaining Time | DigitalOutput_3 Setting Time | DigitalOutput_3 Remaining Time | DigitalOutput_4 Setting Time | DigitalOutput_4 Remaining Time | AnalogOutput_1 Setting Time | AnalogOutput_1 Remaining Time | AnalogOutput_2 Setting Time | AnalogOutput_2 Remaining Time | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |              3               |               3                |              3               |               3                |              3               |               3                |              3               |               3                |              3              |               3               |              3              |               3               |  1   |         6         |
|   示例数据   |       41        | 14052A0C |   00 XXXX    |    FE     |  E022   |    28    |       C002       |     00      |   01   |            XXXXXX            |             XXXXXX             |            XXXXXX            |              XXXX              |            XXXXXX            |             XXXXXX             |            XXXXXX            |             XXXXXX             |           XXXXXX            |             XXXXX             |           XXXXXX            |            XXXXXX             |  D6  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域                         |       说明        | 长度（byte） | 备注                                                         |
| :----------------------------- | :---------------: | :----------: | :----------------------------------------------------------- |
| deviceFrameHead                |     硬件帧头      |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr                           |     设备地址      |      4       |                                                              |
| deviceOthers                   |     控制字等      |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead                      |       帧头        |      1       | FE                                                           |
| frameId                        |       帧ID        |      2       | 查看帧id对照表E022                                           |
| dataLen                        |     数据长度      |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId                   | 控制器设备类型ID  |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast                    |     是否广播      |      1       | 55广播，00单播                                               |
| zoneId                         |      区域Id       |      1       |                                                              |
| DigitalOutput_1 Setting Time   | 数字输出1设定时间 |      3       | 单位S                                                        |
| DigitalOutput_1 Remaining Time | 数字输出1剩余时间 |      3       | 单位S                                                        |
| DigitalOutput_2 Setting Time   | 数字输出2设定时间 |      3       | 单位S                                                        |
| DigitalOutput_2 Remaining Time | 数字输出2剩余时间 |      3       | 单位S                                                        |
| DigitalOutput_3 Setting Time   | 数字输出3设定时间 |      3       | 单位S                                                        |
| DigitalOutput_3 Remaining Time | 数字输出3剩余时间 |      3       | 单位S                                                        |
| DigitalOutput_4 Setting Time   | 数字输出4设定时间 |      3       | 单位S                                                        |
| DigitalOutput_4 Remaining Time | 数字输出4剩余时间 |      3       | 单位S                                                        |
| AnalogOutput_1 Setting Time    | 模拟输出1设定时间 |      3       | 单位S                                                        |
| AnalogOutput_1 Remaining Time  | 模拟输出1剩余时间 |      3       | 单位S                                                        |
| AnalogOutput_2 Setting Time    | 模拟输出2设定时间 |      3       | 单位S                                                        |
| AnalogOutput_2 Remaining Time  | 模拟输出2剩余时间 |      3       | 单位S                                                        |
| CRC8                           |    CRC8校验码     |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd                       |       帧尾        |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

通用控制器(C002)数字输出接口（C003）通道1（挂载设备为电磁阀(0001)）的设定时间为100秒，剩余时间为10秒，模拟输出接口（C004）通道2（挂载设备为风机(0007)的设定时间为520秒，剩余时间为87秒

```js
FE E022 28 C002 00 01 000064 00000A 000000 000000 000000 000000 000000 000000  000000 000000 000208 000057 D6 0D0A0D0A0D0A
```

### 2.11、☆心跳帧(frameId:E023)

> **协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |     8-13     |  14  |       15-20       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :----------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |    控制字    |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID |   RTC时钟    | CRC8 |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId |     RTC      | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |      6       |  1   |         6         |
|   示例数据   |       41        | 14052A0C |   00 XXXX    |    FE     |  E023   |    0A    |       C002       |     00      |   01   | XXXXXXXXXXXX |  D6  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          |       说明       | 长度（byte） | 备注                                                         |
| :-------------- | :--------------: | :----------: | :----------------------------------------------------------- |
| deviceFrameHead |     硬件帧头     |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            |     设备地址     |      4       |                                                              |
| deviceOthers    |     控制字等     |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       |       帧头       |      1       | FE                                                           |
| frameId         |       帧ID       |      2       | 查看帧id对照表E023                                           |
| dataLen         |     数据长度     |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     |     是否广播     |      1       | 55广播，00单播                                               |
| zoneId          |      区域Id      |      1       |                                                              |
| RTC             |     RTC时钟      |      6       | 年月日时分秒（130906093A14代表19年9月6日9点59分20秒）        |
| CRC8            |    CRC8校验码    |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        |       帧尾       |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

通用控制器(C002)的RTC时间为19年9月6日9点59分20秒

```json
FE E023 0A C002 00 01 130906093A14 D6 0D0A0D0A0D0A
```

### 2.12、☆请求RTC时间(frameId:E024)

> **协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |       8-15       |  16  |       17-22       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :--------------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |    控制字    |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID |     预留字段     | CRC8 |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId |     Allocate     | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |        8         |  1   |         6         |
|   示例数据   |       41        | 14052A0C |   00 XXXX    |    FE     |  E024   |    0C    |       C002       |     00      |   01   | XXXXXXXXXXXXXXXX |  D6  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          |       说明       | 长度（byte） | 备注                                                         |
| :-------------- | :--------------: | :----------: | :----------------------------------------------------------- |
| deviceFrameHead |     硬件帧头     |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            |     设备地址     |      4       |                                                              |
| deviceOthers    |     控制字等     |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       |       帧头       |      1       | FE                                                           |
| frameId         |       帧ID       |      2       | 查看帧id对照表E024                                           |
| dataLen         |     数据长度     |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     |     是否广播     |      1       | 55广播，00单播                                               |
| zoneId          |      区域Id      |      1       |                                                              |
| Allocate        |     预留字段     |      8       |                                                              |
| CRC8            |    CRC8校验码    |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        |       帧尾       |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

通用控制器(C002)请求RTC时间

```json
FE E024 0C C002 00 01 0000000000000000 D6 0D0A0D0A0D0A
```

### 2.13、485设备回执(frameId:E025)

> **协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |    8-     |      |                   |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :-------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |    控制字    |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID | 485的回执 | CRC8 |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId |  485para  | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |     N     |  1   |         6         |
|   示例数据   |       41        | 14052A0C |   00 XXXX    |    FE     |  E025   |   N+4    |       C002       |     00      |   01   |     N     |  D6  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          |       说明       | 长度（byte） | 备注                                                         |
| :-------------- | :--------------: | :----------: | :----------------------------------------------------------- |
| deviceFrameHead |     硬件帧头     |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            |     设备地址     |      4       |                                                              |
| deviceOthers    |     控制字等     |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       |       帧头       |      1       | FE                                                           |
| frameId         |       帧ID       |      2       | 查看帧id对照表E025                                           |
| dataLen         |     数据长度     |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     |     是否广播     |      1       | 55广播，00单播                                               |
| zoneId          |      区域Id      |      1       |                                                              |
| 485para         |    485的回执     |      N       |                                                              |
| CRC8            |    CRC8校验码    |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        |       帧尾       |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

通用控制器(C002)回执485指令xxxxxxxxxxxx

```json
FE E025 0A C002 00 01 XXXXXXXXXXXX D6 0D0A0D0A0D0A
```



### 2.14、通用回执指令（frameId:E020）

出厂模式、设置子设备类型及工作组成功/失败、设置数字输出状态成功/失败、设置模拟输出成功/失败、设置关联状态成功/失败、设置预留字段成功/失败、数字输出设备1开启/关闭、数字输出设备1开启/关闭、模拟输出设备1开启/关闭、模拟输出设备2开启/关闭、

## LoRa开关通用回执状态表 

| 状态名称 | FactoryMode |  AskUploadParamsOk   |  AskUploadParamsErr  | AssignGroupIdArrayOk | AssignGroupIdArrayErr | SetSnAndSlaverCountOk  | SetSnAndSlaverCountErr |    TrunOffOk     |    TrunOffErr    | SetParamsOk  | SetParamsErr |
| -------- | :---------: | :------------------: | :------------------: | :------------------: | :-------------------: | :--------------------: | :--------------------: | :--------------: | :--------------: | :----------: | :----------: |
| 状态值   |     00      |          01          |          02          |          03          |          04           |           05           |           06           |        07        |        08        |      09      |      0A      |
| 状态说明 |  出厂模式   | 查询LoRa设备参数成功 | 查询LoRa设备参数失败 |   设置组Id数组成功   |   设置组Id数组失败    | 设置SN及子设备路数成功 | 设置SN及子设备路数失败 | 强制停止设备成功 | 强制停止设备失败 | 设置参数成功 | 设置参数失败 |

**通用回执状态表**：

| 状态名称 | Factory Mode. | Set  Area and SN Success. | Set  Area     and SN Failure. | Set subdevice type and workgroup success | Set subdevice type and workgroup failed | Set digital output status success | Set digital output status failed | Set analog output status success | Set analog output status failed | Set association status  succeed | Set association status  failed | State Storage Exceeding the Upper Limit        | Set reserved field success | Set reserved field failed | Data loss due to abnormal power_off | Set RTC_clock success | Set RTC_clock failed | Set time_interval success | Set time_interval failed | Incorrect information error |      |      |      |      |      |      |
| -------- | ------------- | ------------------------- | ----------------------------- | ---------------------------------------- | --------------------------------------- | --------------------------------- | -------------------------------- | :------------------------------- | :-----------------------------: | :-----------------------------: | :----------------------------: | ---------------------------------------------- | :------------------------: | :-----------------------: | :---------------------------------: | :-------------------: | :------------------: | :-----------------------: | :----------------------: | :-------------------------: | :--: | :--: | :--: | :--: | :--: | :--: |
| 状态值   | 00            | 01                        | 02                            | 03                                       | 04                                      | 05                                | 06                               | 07                               |               08                |               09                |               0A               | 0B                                             |             0C             |            0D             |                 0E                  |          0F           |          10          |            11             |            12            |             13              |  14  |  15  |  16  |  17  |  18  |  19  |
| 状态说明 | 出厂模式      | 设置主设备区域及SN成功    | 设置主设备区域及SN失败        | 设置子设备类型及工作组成功               | 设置子设备类型及工作组失败              | 设置数字输出状态成功              | 设置数字输出状态失败             | 设置模拟输出成功                 |        设置模拟输出失败         |        设置关联状态成功         |        设置关联状态失败        | 关联状态失败，存储的语句超上限或者存储空间不足 |      设置预留字段成功      |     设置预留字段失败      |          异常断电数据丢失           |      设置RTC成功      |     设置RTC失败      |      设置时间段成功       |      设置时间段失败      |        区域信息错误         |      |      |      |      |      |      |

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |   8    |       9-16       |  17  |       18-23       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :----: | :--------------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |    控制字    |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID | 状态值 |     预留字段     | CRC8 |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId | status |     Allocate     | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |   1    |        8         |  1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  E020   |    0D    |       C002       |     00      |   01   |   xx   | 0000000000000000 |  D6  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明             | 长度（byte） | 备注                                                         |
| --------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址         |      4       |                                                              |
| deviceOthers    | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头             |      1       | FE                                                           |
| frameId         | 帧ID             |      2       | 查看帧id对照表A021                                           |
| dataLen         | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id           |      1       |                                                              |
| status          | 状态值           |      1       | 查看E020对应状态表                                           |
| Allocate        | 预留字段         |      8       | 预留的字段                                                   |
| CRC8            | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

发送A013设置主设备区域以及SN后的通用回执E020应该回执【设置主设备区域及SN成功】对应状态表01

```c
61 14052A0C 000000 FE E020 0D C002 00 0X 01 0000000000000000 D6 0D0A0D0A0D0A
```

## 三、通用输出通讯协议及子设备类型对照表（C003）

### 3.1、通用输出设备（开关型）子设备类型对照表（0001~A000）

| slaverTypeId | 子设备类中文名 | 子设备设备英文名 | 厂家 | 型号 | 购买地址 | 备注 |
| ------------ | -------------- | ---------------- | ---- | ---- | -------- | ---- |
| 0001         | 电磁阀         |                  |      |      |          |      |
| 0002         | 照明灯         |                  |      |      |          |      |
| 0003         | 补光灯         |                  |      |      |          |      |
| 0004         | 消毒灯         |                  |      |      |          |      |
| 0005         | 捕虫灯         |                  |      |      |          |      |
| 0006         | 水泵           |                  |      |      |          |      |
| 0007         | 风机           |                  |      |      |          |      |
| 0008         | 排洪泵         |                  |      |      |          |      |
| 0009         | 打药机         |                  |      |      |          |      |

## 五、485设备通讯协议

>  485设备通讯采用透传的方式

### 1、设置485设备参数（A025）

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |    8-     |          |                   |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :-------: | :------: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID | 485的指令 | CRC8校验 |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId |  485para  |   CRC8   |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |     N     |    1     |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A025   |   N-4    |       C002       |     00      |   01   |     N     |    00    | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明             | 长度（byte） | 备注                                                         |
| --------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址         |      4       |                                                              |
| deviceOthers    | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头             |      1       | FE                                                           |
| frameId         | 帧ID             |      2       | 查看帧id对照表A020                                           |
| dataLen         | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id           |      1       |                                                              |
| 485para         | 485指令          |      N       | 485指令                                                      |
| CRC8            | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

```c
61 0C0E2418 000000 FE A025 0C C002 00 01 01 06 2000 0001 43CA D6 0D0A0D0A0D0A
```


变频器



开启或关闭变频器

```json
{
    "confTyp":"FRQ_CON",
    "method":"SET_STATUS",
    "para":{
        "model":"A200",
		"status":1
    }
}
```

设置变频器工作频率

```json
{
    "confTyp":"FRQ_CON",
    "method":"SET_FRQ",
    "para":{
        "model":"A200",
		"frequency":50
    }
}
```

查询

```json
{
    "confTyp":"FRQ_CON",
    "method":"QUERY_STATUS",
    "para":{
        "model":"A200"
    }
}
```

回复

```json
{
    "confTyp":"FRQ_CON",
    "method":"QUERY_STATUS",
    "status":"success",
    "information":"查询A200参数成功",
    "para":{
        "model":"A200",
        "status":0,
        "frequency":0
    }
}
```

## 六、通用回执状态表

## 七、执行方式对照表表

## 八、输入输出接口对照表

## 九、子设备类型对照表







